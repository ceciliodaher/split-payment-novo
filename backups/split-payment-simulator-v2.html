<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Impacto do Split Payment no Fluxo de Caixa</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --accent-color: #e74c3c;
            --dark-accent: #f39c12;
            --highlight-color: #9b59b6;
            --light-bg: #f8f9fa;
            --dark-text: #343a40;
            --gray-text: #6c757d;
            --light-border: #dee2e6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--dark-text);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 20px;
        }

        .tab-container {
            width: 100%;
        }

        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--light-border);
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-text);
            transition: all 0.3s;
        }

        .tab-button.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }

        .panel {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark-text);
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--light-border);
            border-radius: 4px;
            font-size: 14px;
        }

        input[type="number"] {
            text-align: right;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #2980b9;
        }

        .group-box {
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .group-box h3 {
            margin-top: 0;
            color: var(--dark-text);
            font-size: 16px;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table th, table td {
            border: 1px solid var(--light-border);
            padding: 8px;
            text-align: left;
        }

        table th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 20px;
        }

        .strategy-tab-container {
            margin-bottom: 20px;
        }

        .strategy-tab-buttons {
            display: flex;
            border-bottom: 1px solid var(--light-border);
        }

        .strategy-tab-button {
            padding: 8px 15px;
            font-size: 14px;
            background: #f5f5f5;
            border: 1px solid var(--light-border);
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            margin-right: 4px;
            color: var(--gray-text);
            transition: all 0.3s ease;
        }

        .strategy-tab-button.active {
            color: var(--primary-color);
            background: white;
            border-bottom: 2px solid var(--primary-color);
            font-weight: 600;
        }

        .strategy-tab-button:hover:not(.active) {
            background: #e9e9e9;
            color: var(--dark-text);
        }

        .strategy-tab-content {
            display: none;
            padding: 10px 0;
        }

        .strategy-tab-content.active {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .result-value {
            color: var(--primary-color);
            font-weight: bold;
        }

        .positive-value {
            color: var(--secondary-color);
        }

        .negative-value {
            color: var(--accent-color);
        }

        .footer {
            margin-top: 20px;
            text-align: center;
            font-size: 12px;
            color: var(--gray-text);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 400px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-footer {
			margin-top: 15px;
			border-top: 1px solid #dee2e6;
			padding-top: 10px;
		}

		.modal-body {
			padding: 10px 0;
		}

		.close {
			cursor: pointer;
			font-size: 24px;
			font-weight: bold;
		}

		.close:hover {
			color: var(--accent-color);
		}        

        .help-section {
            margin-bottom: 20px;
        }

        .help-section h3 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .help-section ul, .help-section ol {
            padding-left: 20px;
        }

        .help-section li {
            margin-bottom: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        #memoria-calculo {
            font-family: monospace;
            white-space: pre-wrap;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 5px;
            height: 500px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            height: 60px;
            margin-right: 20px;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-column {
            flex: 1;
            min-width: 200px;
        }

        .info-icon {
            color: var(--primary-color);
            font-size: 16px;
            margin-left: 5px;
            cursor: help;
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .result-card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .result-section {
            margin-bottom: 20px;
        }

        .result-section h4 {
            color: var(--primary-color);
            margin-bottom: 10px;
            border-bottom: 1px solid var(--light-border);
            padding-bottom: 5px;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
        }

        .result-table td {
            padding: 8px;
            border-bottom: 1px solid #f0f0f0;
        }

        .result-table td:first-child {
            font-weight: 600;
            width: 60%;
        }

        .result-table td:last-child {
            text-align: right;
        }

        .call-to-action {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .call-to-action button {
            padding: 10px 20px;
        }

        .call-to-action button.secondary {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .call-to-action button.secondary:hover {
            background-color: #f0f7ff;
        }
        
        .data-table {
			width: 100%;
			border-collapse: collapse;
			margin-bottom: 20px;
		}

		.data-table th, .data-table td {
			padding: 10px;
			text-align: left;
			border: 1px solid #dee2e6;
		}

		.data-table th {
			background-color: #f8f9fa;
			position: sticky;
			top: 0;
			z-index: 10;
		}

		.data-table tbody tr:hover {
			background-color: rgba(0, 123, 255, 0.05);
		}

		.action-buttons {
			display: flex;
			gap: 5px;
			justify-content: center;
		}

		.action-buttons button {
			padding: 5px 8px;
			font-size: 12px;
			border-radius: 3px;
			cursor: pointer;
		}

		.action-buttons .edit-btn {
			background-color: #28a745;
			color: white;
			border: none;
		}

		.action-buttons .delete-btn {
			background-color: #dc3545;
			color: white;
			border: none;
		}

		.table-container {
			border: 1px solid #dee2e6;
			border-radius: 5px;
		}

		.btn-help {
			background: none;
			border: none;
			color: var(--primary-color);
			cursor: help;
			font-size: 18px;
			padding: 0 5px;
		}

		.tooltip {
			position: relative;
			display: inline-block;
		}

		.tooltip .tooltiptext {
			visibility: hidden;
			width: 300px;
			background-color: #333;
			color: #fff;
			text-align: left;
			border-radius: 6px;
			padding: 8px;
			position: absolute;
			z-index: 1;
			bottom: 125%;
			left: 50%;
			margin-left: -150px;
			opacity: 0;
			transition: opacity 0.3s;
			font-size: 12px;
			line-height: 1.4;
		}

		.tooltip:hover .tooltiptext {
			visibility: visible;
			opacity: 0.9;
		}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="imagens/expertzy-it.png" alt="Expertzy Inteligência Tributária" class="logo">
            <h1>Simulador de Impacto do Split Payment no Fluxo de Caixa</h1>
        </div>    
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="simulacao">Simulação</button>
                <button class="tab-button" data-tab="configuracoes">Configurações</button>
                <button class="tab-button" data-tab="estrategias">Estratégias de Mitigação</button>
                <button class="tab-button" data-tab="memoria">Memória de Cálculo</button>
                <button class="tab-button" data-tab="ajuda">Ajuda e Documentação</button>
            </div>
            
            <!-- Aba de Simulação -->
            <div id="simulacao" class="tab-content active">
                <div class="grid">
                    <!-- Painel de entrada -->
                    <div class="panel">
                        <div class="group-box">
                            <h3>Dados da Empresa</h3>
                            <div class="form-group">
                                <label for="empresa">Empresa:</label>
                                <input type="text" id="empresa" placeholder="Nome da empresa">
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="faturamento">Faturamento Mensal:</label>
                                        <input type="text" id="faturamento" value="0" class="money-input">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="margem">Margem Operacional (%):</label>
                                        <input type="number" id="margem" value="15" min="0" max="100" step="0.1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="setor">Setor de Atividade:</label>
                                        <select id="setor">
                                            <option value="comercio">Comércio Varejista</option>
                                            <option value="industria">Indústria de Transformação</option>
                                            <option value="servicos">Serviços Contínuos</option>
                                            <option value="agronegocio">Agronegócio</option>
                                            <option value="construcao">Construção Civil</option>
                                            <option value="tecnologia">Tecnologia</option>
                                            <option value="saude">Saúde</option>
                                            <option value="educacao">Educação</option>
                                            <option value="outro">Outro</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="regime">Regime Tributário:</label>
                                        <select id="regime">
                                            <option value="simples">Simples Nacional</option>
                                            <option value="presumido">Lucro Presumido</option>
                                            <option value="real">Lucro Real</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="group-box">
                            <h3>Ciclo Financeiro</h3>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="pmr">Prazo Médio de Recebimento (dias):</label>
                                        <input type="number" id="pmr" value="30" min="0" step="1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="pmp">Prazo Médio de Pagamento (dias):</label>
                                        <input type="number" id="pmp" value="30" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="pme">Prazo Médio de Estoque (dias):</label>
                                        <input type="number" id="pme" value="30" min="0" step="1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ciclo-financeiro">Ciclo Financeiro (dias):</label>
                                        <input type="number" id="ciclo-financeiro" value="30" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="perc-vista">Percentual de Vendas à Vista (%):</label>
                                        <input type="number" id="perc-vista" value="30" min="0" max="100" step="1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="perc-prazo">Percentual de Vendas a Prazo (%):</label>
                                        <input type="number" id="perc-prazo" value="70" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="group-box">
                            <h3>Tributação e Split Payment</h3>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="aliquota">Alíquota Efetiva (%):</label>
                                        <input type="number" id="aliquota" value="26.5" min="0" max="100" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="tipo-operacao">Tipo de Operação:</label>
                                        <select id="tipo-operacao">
                                            <option value="b2b">B2B (Empresa-Empresa)</option>
                                            <option value="b2c">B2C (Empresa-Consumidor)</option>
                                            <option value="mista">Mista</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="creditos">Créditos Tributários Mensais:</label>
                                        <input type="text" id="creditos" value="0" class="money-input">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="compensacao">Compensação de Créditos:</label>
                                        <select id="compensacao">
                                            <option value="automatica">Automática (Tempo Real)</option>
                                            <option value="mensal">Mensal</option>
                                            <option value="trimestral">Trimestral</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="group-box">
                            <h3>Parâmetros da Simulação</h3>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="data-inicial">Data Inicial:</label>
                                        <input type="date" id="data-inicial" value="2026-01-01">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="data-final">Data Final:</label>
                                        <input type="date" id="data-final" value="2033-12-31">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cenario">Cenário de Crescimento:</label>
                                        <select id="cenario">
                                            <option value="conservador">Conservador (2% a.a.)</option>
                                            <option value="moderado" selected>Moderado (5% a.a.)</option>
                                            <option value="otimista">Otimista (8% a.a.)</option>
                                            <option value="personalizado">Personalizado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group" id="cenario-personalizado" style="display: none;">
                                        <label for="taxa-crescimento">Taxa de Crescimento (% a.a.):</label>
                                        <input type="number" id="taxa-crescimento" value="5" min="0" max="100" step="0.1">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <button id="btn-simular" style="width: 100%; padding: 15px; font-size: 16px;">Simular Impacto no Fluxo de Caixa</button>
                    </div>

                    <!-- Painel de resultados -->
                    <div class="panel">
                        <h3>Resultados da Simulação</h3>
                        <div id="resultados">
                            <p class="text-muted">Preencha os dados e clique em "Simular" para visualizar os resultados.</p>
                        </div>

                        <div class="group-box">
                            <h3>Gráficos Comparativos</h3>
                            <div class="chart-container">
                                <canvas id="grafico-fluxo-caixa"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="grafico-capital-giro"></canvas>
                            </div>
                            <div class="chart-container">
                                <canvas id="grafico-projecao"></canvas>
                            </div>
                        </div>

                        <div class="group-box">
                            <h3>Exportar Resultados</h3>
                            <div class="button-group">
                                <button id="btn-exportar-pdf">Exportar PDF</button>
                                <button id="btn-exportar-excel">Exportar Excel</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Aba de Configurações -->
            <div id="configuracoes" class="tab-content">
                <div class="group-box">
                    <h3>Parâmetros Financeiros</h3>
                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="taxa-antecipacao">Taxa de Antecipação de Recebíveis (% a.m.):</label>
                                <input type="number" id="taxa-antecipacao" value="1.8" min="0" step="0.1">
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="taxa-capital-giro">Taxa de Capital de Giro (% a.m.):</label>
                                <input type="number" id="taxa-capital-giro" value="2.1" min="0" step="0.1">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-column">
                            <div class="form-group">
                                <label for="spread-bancario">Spread Bancário (p.p.):</label>
                                <input type="number" id="spread-bancario" value="3.5" min="0" step="0.1">
                            </div>
                        </div>
                        <div class="form-column">
                            <div class="form-group">
                                <label for="custo-adequacao">Custo de Adequação Tecnológica (R$):</label>
                                <input type="text" id="custo-adequacao" value="0" class="money-input">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="group-box">
                    <h3>Fases da Implementação do Split Payment</h3>
                    <table id="tabela-fases">
                        <thead>
                            <tr>
                                <th>Ano</th>
                                <th>Percentual (%)</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>2026</td><td><input type="number" data-ano="2026" value="10" step="1" min="0" max="100"></td></tr>
                            <tr><td>2027</td><td><input type="number" data-ano="2027" value="25" step="1" min="0" max="100"></td></tr>
                            <tr><td>2028</td><td><input type="number" data-ano="2028" value="40" step="1" min="0" max="100"></td></tr>
                            <tr><td>2029</td><td><input type="number" data-ano="2029" value="60" step="1" min="0" max="100"></td></tr>
                            <tr><td>2030</td><td><input type="number" data-ano="2030" value="80" step="1" min="0" max="100"></td></tr>
                            <tr><td>2031</td><td><input type="number" data-ano="2031" value="90" step="1" min="0" max="100"></td></tr>
                            <tr><td>2032</td><td><input type="number" data-ano="2032" value="95" step="1" min="0" max="100"></td></tr>
                            <tr><td>2033</td><td><input type="number" data-ano="2033" value="100" step="1" min="0" max="100"></td></tr>
                        </tbody>
                    </table>
                </div>

                <!-- Substituir o conteúdo atual da aba "Configurações Setoriais" pelo seguinte: -->
				<div class="group-box">
					<h3>Parâmetros Setoriais</h3>
					<div class="button-group" style="margin-bottom: 15px;">
						<button id="btn-adicionar-setor" class="secondary">Adicionar Novo Setor</button>
						<button id="btn-importar-setores" class="secondary">Importar Setores da Reforma</button>
					</div>
					
					<div id="form-novo-setor" style="display: none; background: #f8f9fa; padding: 15px; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ddd;">
						<h4>Adicionar/Editar Setor</h4>
						<div class="form-row">
							<div class="form-column">
								<div class="form-group">
									<label for="setor-nome">Nome do Setor:</label>
									<input type="text" id="setor-nome" value="" required>
								</div>
							</div>
							<div class="form-column">
								<div class="form-group">
									<label for="setor-codigo">Código do Setor:</label>
									<input type="text" id="setor-codigo" value="" required>
									<small>Código único para identificação (sem espaços ou caracteres especiais)</small>
								</div>
							</div>
						</div>
						<div class="form-row">
							<div class="form-column">
								<div class="form-group">
									<label for="setor-aliquota">Alíquota Efetiva (%):</label>
									<input type="number" id="setor-aliquota" value="26.5" min="0" max="100" step="0.1" required>
								</div>
							</div>
							<div class="form-column">
								<div class="form-group">
									<label for="setor-reducao">Redução Especial (%):</label>
									<input type="number" id="setor-reducao" value="0" min="0" max="100" step="0.1" required>
								</div>
							</div>
						</div>
						<div class="form-row">
							<div class="form-column">
								<div class="form-group">
									<label for="setor-implementacao">Implementação Inicial (%):</label>
									<input type="number" id="setor-implementacao" value="10" min="0" max="100" step="1" required>
								</div>
							</div>
							<div class="form-column">
								<div class="form-group">
									<label for="setor-cronograma">Cronograma:</label>
									<select id="setor-cronograma">
										<option value="padrao">Padrão</option>
										<option value="proprio">Próprio</option>
									</select>
								</div>
							</div>
						</div>
						<div class="button-group">
							<button id="btn-salvar-setor" class="primary">Salvar Setor</button>
							<button id="btn-cancelar-setor" class="secondary">Cancelar</button>
						</div>
						<input type="hidden" id="setor-modo" value="novo">
						<input type="hidden" id="setor-original-codigo" value="">
					</div>
					
					<div class="search-box" style="margin-bottom: 15px;">
						<input type="text" id="busca-setor" placeholder="Buscar setor..." style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
					</div>
					
					<div class="table-container" style="max-height: 600px; overflow-y: auto;">
						<table id="tabela-setores" class="data-table">
							<thead>
								<tr>
									<th style="width: 30%;">Setor</th>
									<th>Alíquota (%)</th>
									<th>Redução (%)</th>
									<th>Impl. (%)</th>
									<th>Cronograma</th>
									<th style="width: 100px;">Ações</th>
								</tr>
							</thead>
							<tbody>
								<!-- Os setores serão carregados via JavaScript -->
							</tbody>
						</table>
					</div>
				</div>

                <div class="button-group">
                    <button id="btn-salvar-config">Salvar Configurações</button>
                    <button id="btn-carregar-config">Carregar Configurações</button>
                    <button id="btn-restaurar-config">Restaurar Padrões</button>
                </div>
            </div>

            <!-- Aba de Estratégias de Mitigação -->
            <div id="estrategias" class="tab-content">
                <div class="strategy-tab-container">
                    <div class="strategy-tab-buttons">
                        <button class="strategy-tab-button active" data-strategy-tab="ajuste-precos">Ajuste de Preços</button>
                        <button class="strategy-tab-button" data-strategy-tab="renegociacao-prazos">Renegociação de Prazos</button>
                        <button class="strategy-tab-button" data-strategy-tab="antecipacao-recebiveis">Antecipação de Recebíveis</button>
                        <button class="strategy-tab-button" data-strategy-tab="capital-giro">Capital de Giro</button>
                        <button class="strategy-tab-button" data-strategy-tab="mix-produtos">Mix de Produtos</button>
                        <button class="strategy-tab-button" data-strategy-tab="meios-pagamento">Meios de Pagamento</button>
                    </div>
                    
                    <!-- Ajuste de Preços -->
                    <div id="estrategia-ajuste-precos" class="strategy-tab-content active">
                        <div class="group-box">
                            <h3>Ajuste de Preços</h3>
                            <p>Compensar a perda de fluxo de caixa através de aumento em preços.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-ativar">Ativar Estratégia:</label>
                                        <select id="ap-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-percentual">Percentual de Aumento (%):</label>
                                        <input type="number" id="ap-percentual" value="5" min="0" max="100" step="0.1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-elasticidade">Elasticidade-Preço da Demanda:</label>
                                        <input type="number" id="ap-elasticidade" value="-1.2" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-impacto-vendas">Impacto nas Vendas (%):</label>
                                        <input type="number" id="ap-impacto-vendas" value="0" readonly>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ap-periodo">Período de Ajuste (meses):</label>
                                        <input type="number" id="ap-periodo" value="3" min="1" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Renegociação de Prazos -->
                    <div id="estrategia-renegociacao-prazos" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Renegociação de Prazos</h3>
                            <p>Negociar prazos mais longos com fornecedores para melhorar o ciclo financeiro.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-ativar">Ativar Estratégia:</label>
                                        <select id="rp-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-aumento-prazo">Aumento do Prazo (dias):</label>
                                        <input type="number" id="rp-aumento-prazo" value="15" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-percentual">Percentual de Fornecedores (%):</label>
                                        <input type="number" id="rp-percentual" value="60" min="0" max="100" step="1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-contrapartidas">Contrapartidas:</label>
                                        <select id="rp-contrapartidas">
                                            <option value="nenhuma">Nenhuma</option>
                                            <option value="volume">Aumento de Volume</option>
                                            <option value="precos">Reajuste de Preços</option>
                                            <option value="contratos">Compromisso Contratual</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="rp-custo">Custo da Contrapartida (%):</label>
                                        <input type="number" id="rp-custo" value="0" min="0" step="0.1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Antecipação de Recebíveis -->
                    <div id="estrategia-antecipacao-recebiveis" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Antecipação de Recebíveis</h3>
                            <p>Antecipar recebíveis para compensar o impacto no capital de giro.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-ativar">Ativar Estratégia:</label>
                                        <select id="ar-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-percentual">Percentual de Antecipação (%):</label>
                                        <input type="number" id="ar-percentual" value="50" min="0" max="100" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-taxa">Taxa de Desconto (% a.m.):</label>
                                        <input type="number" id="ar-taxa" value="1.8" min="0" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="ar-prazo">Prazo Médio Antecipado (dias):</label>
                                        <input type="number" id="ar-prazo" value="25" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Capital de Giro -->
                    <div id="estrategia-capital-giro" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Capital de Giro</h3>
                            <p>Contratação de linha de capital de giro para suprir a necessidade adicional.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-ativar">Ativar Estratégia:</label>
                                        <select id="cg-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-valor">Valor de Captação (%):</label>
                                        <input type="number" id="cg-valor" value="100" min="0" max="200" step="1">
                                        <small>Percentual da necessidade adicional de capital</small>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-taxa">Taxa de Juros (% a.m.):</label>
                                        <input type="number" id="cg-taxa" value="2.1" min="0" step="0.1">
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-prazo">Prazo de Pagamento (meses):</label>
                                        <input type="number" id="cg-prazo" value="12" min="1" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="cg-carencia">Carência (meses):</label>
                                        <input type="number" id="cg-carencia" value="3" min="0" step="1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mix de Produtos -->
                    <div id="estrategia-mix-produtos" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Mix de Produtos</h3>
                            <p>Ajustar mix de produtos para priorizar itens com ciclo financeiro mais favorável.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-ativar">Ativar Estratégia:</label>
                                        <select id="mp-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-percentual">Percentual de Ajuste (%):</label>
                                        <input type="number" id="mp-percentual" value="30" min="0" max="100" step="1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-foco">Foco do Ajuste:</label>
                                        <select id="mp-foco">
                                            <option value="ciclo">Ciclo Financeiro</option>
                                            <option value="margem">Margem de Contribuição</option>
                                            <option value="vista">Vendas à Vista</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-impacto-receita">Impacto na Receita (%):</label>
                                        <input type="number" id="mp-impacto-receita" value="-5" step="0.1">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-impacto-margem">Impacto na Margem (p.p.):</label>
                                        <input type="number" id="mp-impacto-margem" value="3.5" step="0.1">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Meios de Pagamento -->
                    <div id="estrategia-meios-pagamento" class="strategy-tab-content">
                        <div class="group-box">
                            <h3>Meios de Pagamento</h3>
                            <p>Incentivar meios de pagamento mais favoráveis ao fluxo de caixa.</p>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-pag-ativar">Ativar Estratégia:</label>
                                        <select id="mp-pag-ativar">
                                            <option value="0">Não</option>
                                            <option value="1">Sim</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Distribuição Atual:</label>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-vista-atual">À Vista (%):</label>
                                            <input type="number" id="mp-pag-vista-atual" value="30" min="0" max="100" step="1" readonly>
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-prazo-atual">A Prazo (%):</label>
                                            <input type="number" id="mp-pag-prazo-atual" value="70" min="0" max="100" step="1" readonly>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label>Nova Distribuição:</label>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-vista-novo">À Vista (%):</label>
                                            <input type="number" id="mp-pag-vista-novo" value="40" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-30-novo">30 dias (%):</label>
                                            <input type="number" id="mp-pag-30-novo" value="30" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-60-novo">60 dias (%):</label>
                                            <input type="number" id="mp-pag-60-novo" value="20" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                    <div class="form-column">
                                        <div class="form-group">
                                            <label for="mp-pag-90-novo">90 dias (%):</label>
                                            <input type="number" id="mp-pag-90-novo" value="10" min="0" max="100" step="1">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-column">
                                    <div class="form-group">
                                        <label for="mp-pag-taxa-incentivo">Taxa de Incentivo (%):</label>
                                        <input type="number" id="mp-pag-taxa-incentivo" value="3" min="0" step="0.1">
                                        <small>Desconto para pagamentos à vista</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="group-box">
                    <h3>Resultados Estimados com Estratégias</h3>
                    <div id="resultados-estrategias">
                        <p class="text-muted">Selecione as estratégias de mitigação e simule para ver os resultados estimados.</p>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="grafico-estrategias"></canvas>
                </div>
                
                <div class="button-group">
                    <button id="btn-simular-estrategias">Simular Estratégias</button>
                    <button id="btn-exportar-estrategias">Exportar Relatório</button>
                </div>
            </div>

            <!-- Aba de Memória de Cálculo -->
            <div id="memoria" class="tab-content">
                <div class="form-group">
                    <label for="select-ano-memoria">Selecione o ano:</label>
                    <select id="select-ano-memoria">
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                        <option value="2032">2032</option>
                        <option value="2033">2033</option>
                    </select>
                </div>
                <button id="btn-atualizar-memoria">Atualizar Memória</button>
                <div id="memoria-calculo">
                    Realize uma simulação para gerar a memória de cálculo detalhada.
                </div>
                <div class="button-group">
                    <button id="btn-exportar-memoria">Exportar Memória de Cálculo</button>
                </div>
            </div>

            <!-- Aba de Ajuda e Documentação -->
            <div id="ajuda" class="tab-content">
                <div class="help-section">
                    <h3>O que é o Split Payment?</h3>
                    <p>O Split Payment é um mecanismo introduzido pela reforma tributária brasileira (LC 214/2025) que automatiza o recolhimento tributário no momento da transação comercial, separando o valor do tributo do preço do bem ou serviço e direcionando-o diretamente aos cofres públicos.</p>
                    <p>Este sistema altera significativamente o fluxo de caixa das empresas, pois elimina o intervalo entre o recebimento da venda e o pagamento do imposto, que tradicionalmente ocorria no mês seguinte.</p>
                </div>

                <div class="help-section">
                    <h3>Como funciona o Split Payment?</h3>
                    <p>No modelo padrão, ao realizar uma venda com split payment, o sistema divide automaticamente o valor:</p>
                    <ul>
                        <li><strong>Parte do valor</strong> é creditada diretamente ao vendedor.</li>
                        <li><strong>Parte correspondente aos impostos</strong> é direcionada automaticamente ao Comitê Gestor do IBS e à Receita Federal.</li>
                    </ul>
                    <p>Por exemplo, em uma venda de R$ 1.000 com alíquota de 26,5%, aproximadamente R$ 735,50 são creditados ao vendedor e R$ 264,50 vão direto para o fisco.</p>
                </div>

                <div class="help-section">
                    <h3>Impacto no Fluxo de Caixa</h3>
                    <p>O principal impacto do split payment é a redução do capital de giro disponível, pois o valor do tributo deixa de estar temporariamente sob controle da empresa. No regime anterior, as empresas utilizavam o montante tributário entre o recebimento da venda e o recolhimento do imposto como capital de giro.</p>
                </div>

                <div class="help-section">
                    <h3>Como usar o Simulador</h3>
                    <ol>
                        <li><strong>Aba Simulação</strong>: Preencha os dados da empresa, ciclo financeiro, parâmetros de tributação e simulação, e clique em "Simular" para visualizar o impacto no fluxo de caixa.</li>
                        <li><strong>Aba Configurações</strong>: Ajuste parâmetros financeiros e setoriais para personalizar a simulação.</li>
                        <li><strong>Aba Estratégias de Mitigação</strong>: Teste diferentes estratégias para mitigar o impacto do split payment no fluxo de caixa.</li>
                        <li><strong>Aba Memória de Cálculo</strong>: Visualize os cálculos detalhados por trás dos resultados apresentados.</li>
                    </ol>
                </div>

                <div class="help-section">
                    <h3>Implementação Progressiva</h3>
                    <p>O split payment será implementado gradualmente, começando com testes piloto em 2026 e alcançando implementação total em 2033. Durante esse período, apenas uma parcela dos tributos será recolhida via split payment, aumentando progressivamente conforme o cronograma oficial.</p>
                </div>
            </div>
        </div>
        
        <div class="footer">
            &copy; 2025 Expertzy Inteligência Tributária
        </div>
    </div>

    <!-- Modal de confirmação de exclusão -->
	<div id="modal-confirmar-exclusao" class="modal">
		<div class="modal-content" style="max-width: 400px;">
			<div class="modal-header">
				<h3>Confirmar Exclusão</h3>
				<span class="close">&times;</span>
			</div>
			<div class="modal-body">
				<p>Tem certeza que deseja excluir o setor <span id="nome-setor-exclusao"></span>?</p>
				<p>Esta ação não pode ser desfeita.</p>
			</div>
			<div class="modal-footer">
				<button id="btn-confirmar-exclusao" class="primary">Sim, Excluir</button>
				<button id="btn-cancelar-exclusao" class="secondary">Cancelar</button>
			</div>
		</div>
	</div>
	
    <!-- Modal para ajuda contextual -->
    <div id="modal-ajuda" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-ajuda-titulo">Ajuda</h3>
                <span class="close">&times;</span>
            </div>
            <div id="modal-ajuda-conteudo">
                <!-- Conteúdo dinâmico da ajuda -->
            </div>
        </div>
    </div>
    
    <script src="setores-integration.js"></script>
    <script>
        // Inicialização do sistema ao carregar a página
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar sistema de abas
            inicializarAbas();
            
            // Inicializar abas de estratégias
            inicializarAbasEstrategias();
            
            // Inicialização de campos e eventos
            inicializarCampos();
            
            // Evento para o botão Simular
            document.getElementById('btn-simular').addEventListener('click', function() {
                simularImpacto();
            });
            
            // Eventos para atualização da memória de cálculo
            document.getElementById('btn-atualizar-memoria').addEventListener('click', function() {
                atualizarMemoriaCalculo();
            });
            
            // Exportação
            document.getElementById('btn-exportar-pdf').addEventListener('click', function() {
                exportarParaPDF();
            });
            
            document.getElementById('btn-exportar-excel').addEventListener('click', function() {
                exportarParaExcel();
            });
            
            document.getElementById('btn-exportar-memoria').addEventListener('click', function() {
                exportarMemoriaCalculo();
            });
            
            // Configurações
            document.getElementById('btn-salvar-config').addEventListener('click', function() {
                salvarConfiguracoes();
            });
            
            document.getElementById('btn-carregar-config').addEventListener('click', function() {
                carregarConfiguracoes();
            });
            
            document.getElementById('btn-restaurar-config').addEventListener('click', function() {
                restaurarPadroes();
            });
            
            // Estratégias
            document.getElementById('btn-simular-estrategias').addEventListener('click', function() {
                simularEstrategias();
            });
            
            document.getElementById('btn-exportar-estrategias').addEventListener('click', function() {
                exportarRelatorioEstrategias();
            });
            
            // Atualizar campos calculados
            document.getElementById('perc-vista').addEventListener('input', function() {
                atualizarPercPrazo();
            });
            
            // Evento para selecionar cenário personalizado
            document.getElementById('cenario').addEventListener('change', function() {
                const cenarioPersonalizado = document.getElementById('cenario-personalizado');
                if (this.value === 'personalizado') {
                    cenarioPersonalizado.style.display = 'block';
                } else {
                    cenarioPersonalizado.style.display = 'none';
                }
            });
            
            // Calcular ciclo financeiro
            ['pmr', 'pmp', 'pme'].forEach(function(id) {
                document.getElementById(id).addEventListener('input', function() {
                    calcularCicloFinanceiro();
                });
            });
            
            // Cálculo de elasticidade
            document.getElementById('ap-percentual').addEventListener('input', function() {
                calcularImpactoElasticidade();
            });
            
            document.getElementById('ap-elasticidade').addEventListener('input', function() {
                calcularImpactoElasticidade();
            });
            
            // Sincronizar campos relacionados
            document.getElementById('perc-vista').addEventListener('input', function() {
                document.getElementById('mp-pag-vista-atual').value = this.value;
                document.getElementById('mp-pag-prazo-atual').value = 100 - parseFloat(this.value);
            });
            
            // Inicializar valores
            calcularCicloFinanceiro();
            atualizarPercPrazo();
        });
        
        // Sistema de navegação por abas
        function inicializarAbas() {
            const botoes = document.querySelectorAll('.tab-button');
            const conteudos = document.querySelectorAll('.tab-content');
            
            botoes.forEach(botao => {
                botao.addEventListener('click', () => {
                    const tabId = botao.getAttribute('data-tab');
                    
                    // Remover active de todos
                    botoes.forEach(b => b.classList.remove('active'));
                    conteudos.forEach(c => c.classList.remove('active'));
                    
                    // Adicionar active ao selecionado
                    botao.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }
        
        // Sistema de navegação por abas de estratégias
        function inicializarAbasEstrategias() {
            const botoes = document.querySelectorAll('.strategy-tab-button');
            const conteudos = document.querySelectorAll('.strategy-tab-content');
            
            botoes.forEach(botao => {
                botao.addEventListener('click', () => {
                    const tabId = botao.getAttribute('data-strategy-tab');
                    
                    // Remover active de todos
                    botoes.forEach(b => b.classList.remove('active'));
                    conteudos.forEach(c => c.classList.remove('active'));
                    
                    // Adicionar active ao selecionado
                    botao.classList.add('active');
                    document.getElementById('estrategia-' + tabId).classList.add('active');
                });
            });
        }
        
        // Inicialização de campos e eventos
        function inicializarCampos() {
            // Formatação para campos monetários
            document.querySelectorAll('.money-input').forEach(input => {
                input.addEventListener('blur', function() {
                    formatarMoeda(this);
                });
                
                // Formatar valor inicial
                formatarMoeda(input);
            });
        }
        
        // Formatação de valores monetários
        function formatarMoeda(input) {
            let valor = input.value.replace(/\D/g, '');
            valor = (parseFloat(valor) / 100).toFixed(2);
            valor = valor.replace('.', ',');
            valor = valor.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1.');
            input.value = 'R$ ' + valor;
        }
        
        // Extrair valor numérico de um campo formatado como moeda
        function extrairValorNumerico(valor) {
            if (typeof valor === 'string') {
                return parseFloat(valor.replace(/[^\d,.-]/g, '').replace(',', '.')) || 0;
            }
            return parseFloat(valor) || 0;
        }
        
        // Calcular o ciclo financeiro
        function calcularCicloFinanceiro() {
            const pmr = parseInt(document.getElementById('pmr').value) || 0;
            const pmp = parseInt(document.getElementById('pmp').value) || 0;
            const pme = parseInt(document.getElementById('pme').value) || 0;
            
            const ciclo = pmr + pme - pmp;
            document.getElementById('ciclo-financeiro').value = ciclo;
        }
        
        // Atualizar o percentual de vendas a prazo
        function atualizarPercPrazo() {
            const percVista = parseFloat(document.getElementById('perc-vista').value) || 0;
            const percPrazo = 100 - percVista;
            document.getElementById('perc-prazo').value = percPrazo;
            
            // Atualizar também os campos na aba de estratégias
            document.getElementById('mp-pag-vista-atual').value = percVista;
            document.getElementById('mp-pag-prazo-atual').value = percPrazo;
        }
        
        // Calcular o impacto da elasticidade no ajuste de preços
        function calcularImpactoElasticidade() {
            const percentual = parseFloat(document.getElementById('ap-percentual').value) || 0;
            const elasticidade = parseFloat(document.getElementById('ap-elasticidade').value) || 0;
            
            const impacto = percentual * elasticidade;
            document.getElementById('ap-impacto-vendas').value = impacto.toFixed(2);
        }
        
        // Simulação do impacto do Split Payment
        function simularImpacto() {
            // Lógica de simulação será implementada posteriormente
            // Verificar se devemos usar cálculo setorial
			const codigoSetor = document.getElementById('setor').value;
			if (codigoSetor && SetoresManager.setores[codigoSetor]) {
				console.log(`Usando cálculo setorial para o setor "${SetoresManager.setores[codigoSetor].nome}"`);
				
				// Adicionar setor aos dados
				dados.setor = codigoSetor;
				
				// Executar simulação setorial
				const resultadoSetorial = SimuladorFluxoCaixa.calcularImpactoSetorial(dados, anoInicial);
				
				// Armazenar resultado
				resultados.impactoSetorial = resultadoSetorial;
				
				// Exibir resultados com informações setoriais
				exibirResultadosSetoriais(resultados);
				
				// Atualizar memória de cálculo com informações setoriais
				atualizarMemoriaCalculoSetorial(anoInicial);
			} else {
				// Usar simulação padrão (código existente)
				// [Mantenha o código existente para simulação padrão]
			}
            // Esta é apenas uma estrutura inicial para demonstração
            
            // No momento, vamos apenas exibir um resultado de exemplo
            exibirResultadoExemplo();
        }
        
        // Exibir um resultado de exemplo para demonstração
        function exibirResultadoExemplo() {
            // Obter valores básicos do formulário
            const faturamento = extrairValorNumerico(document.getElementById('faturamento').value);
            const aliquota = parseFloat(document.getElementById('aliquota').value) / 100;
            const pmr = parseInt(document.getElementById('pmr').value);
            
            // Cálculos de exemplo
            const valorImposto = faturamento * aliquota;
            const impactoMensal = valorImposto;
            const impactoAnual = impactoMensal * 12;
            const percentualImplementacao = 0.10; // Exemplo para 2026 (10%)
            const impactoInicial = impactoMensal * percentualImplementacao;
            const impactoPercentual = (impactoInicial / faturamento) * 100;
            
            // Construir HTML dos resultados
            const html = `
                <div class="result-card">
                    <h3>Resultados da Simulação</h3>

                    <div class="result-section">
                        <h4>Impacto Inicial (2026)</h4>
                        <table class="result-table">
                            <tr>
                                <td>Percentual de Implementação:</td>
                                <td>10%</td>
                            </tr>
                            <tr>
                                <td>Diferença no Capital de Giro:</td>
                                <td class="negative">R$ ${formatarNumero(impactoInicial)}</td>
                            </tr>
                            <tr>
                                <td>Impacto Percentual:</td>
                                <td class="negative">${formatarNumero(impactoPercentual)}%</td>
                            </tr>
                            <tr>
                                <td>Necessidade Adicional de Capital:</td>
                                <td>R$ ${formatarNumero(impactoInicial * 1.2)}</td>
                            </tr>
                            <tr>
                                <td>Impacto na Margem Operacional:</td>
                                <td>De 15,00% para 13,75%</td>
                            </tr>
                        </table>
                    </div>

                    <div class="result-section">
                        <h4>Projeção do Impacto</h4>
                        <p>Impacto acumulado ao longo do período 2026-2033:</p>
                        <table class="result-table">
                            <tr>
                                <td>Necessidade Total de Capital:</td>
                                <td>R$ ${formatarNumero(impactoAnual * 4)}</td>
                            </tr>
                            <tr>
                                <td>Custo Financeiro Total:</td>
                                <td>R$ ${formatarNumero(impactoAnual * 0.25)}</td>
                            </tr>
                            <tr>
                                <td>Impacto Médio na Margem:</td>
                                <td>1,25%</td>
                            </tr>
                        </table>
                    </div>

                    <div class="call-to-action">
                        <button id="btn-estrategias" class="primary">Simular Estratégias de Mitigação</button>
                        <button id="btn-detalhes" class="secondary">Ver Detalhes Completos</button>
                    </div>
                </div>
            `;
            
            // Inserir o HTML no container
            document.getElementById('resultados').innerHTML = html;
            
            // Adicionar event listeners aos botões
            document.getElementById('btn-estrategias').addEventListener('click', function() {
                document.querySelector('.tab-button[data-tab="estrategias"]').click();
            });
            
            document.getElementById('btn-detalhes').addEventListener('click', function() {
                document.querySelector('.tab-button[data-tab="memoria"]').click();
            });
            
            // Inicializar gráficos de exemplo
            inicializarGraficosExemplo();
        }
        
        // Inicializar gráficos de exemplo
        function inicializarGraficosExemplo() {
            // Gráfico de Fluxo de Caixa
            const ctxFluxo = document.getElementById('grafico-fluxo-caixa').getContext('2d');
            new Chart(ctxFluxo, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [
                        {
                            label: 'Fluxo Atual',
                            data: [25000, 28000, 27000, 30000, 29000, 32000],
                            backgroundColor: '#3498db',
                            borderColor: '#3498db',
                            borderWidth: 1
                        },
                        {
                            label: 'Fluxo com Split Payment',
                            data: [22500, 25200, 24300, 27000, 26100, 28800],
                            backgroundColor: '#e74c3c',
                            borderColor: '#e74c3c',
                            borderWidth: 1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Comparativo de Fluxo de Caixa',
                            font: { size: 16 }
                        },
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + formatarNumero(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + formatarNumero(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Gráfico de Capital de Giro
            const ctxCapital = document.getElementById('grafico-capital-giro').getContext('2d');
            new Chart(ctxCapital, {
                type: 'line',
                data: {
                    labels: ['Pré-Split', '2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033'],
                    datasets: [
                        {
                            label: 'Necessidade de Capital de Giro',
                            data: [100000, 110000, 125000, 140000, 160000, 180000, 190000, 195000, 200000],
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            fill: true,
                            tension: 0.1
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolução da Necessidade de Capital de Giro',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'R$ ' + formatarNumero(context.raw);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + formatarNumero(value);
                                }
                            }
                        }
                    }
                }
            });
            
            // Gráfico de Projeção
            const ctxProjecao = document.getElementById('grafico-projecao').getContext('2d');
            new Chart(ctxProjecao, {
                type: 'line',
                data: {
                    labels: ['2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033'],
                    datasets: [
                        {
                            label: 'Impacto % do Split Payment',
                            data: [2.5, 6.25, 10, 15, 20, 22.5, 23.75, 25],
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: true,
                            tension: 0.1,
                            yAxisID: 'y'
                        },
                        {
                            label: 'Margem Operacional (%)',
                            data: [15, 14.5, 13.75, 12.5, 11.25, 10.5, 10.25, 10],
                            borderColor: '#2ecc71',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            fill: true,
                            tension: 0.1,
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Impacto na Margem Operacional',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatarNumero(context.raw) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Impacto %'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarNumero(value) + '%';
                                }
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Margem %'
                            },
                            ticks: {
                                callback: function(value) {
                                    return formatarNumero(value) + '%';
                                }
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }
        
        // Simulação de estratégias de mitigação
        function simularEstrategias() {
            // Lógica de simulação de estratégias será implementada posteriormente
            
            // Gráfico de Estratégias (exemplo)
            const ctxEstrategias = document.getElementById('grafico-estrategias').getContext('2d');
            new Chart(ctxEstrategias, {
                type: 'bar',
                data: {
                    labels: ['Sem Estratégia', 'Ajuste de Preços', 'Renegociação', 'Antecipação', 'Capital de Giro', 'Mix de Produtos', 'Meios de Pagamento', 'Todas Estratégias'],
                    datasets: [
                        {
                            label: 'Impacto na Necessidade de Capital (%)',
                            data: [100, 85, 80, 75, 50, 70, 65, 30],
                            backgroundColor: [
                                '#e74c3c',
                                '#3498db',
                                '#2ecc71',
                                '#9b59b6',
                                '#f39c12',
                                '#1abc9c',
                                '#34495e',
                                '#27ae60'
                            ]
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Eficácia das Estratégias de Mitigação',
                            font: { size: 16 }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatarNumero(context.raw) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            min: 0,
                            max: 100,
                            ticks: {
                                callback: function(value) {
                                    return formatarNumero(value) + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Resultados das estratégias (exemplo)
            document.getElementById('resultados-estrategias').innerHTML = `
                <div class="result-section">
                    <h4>Síntese das Estratégias</h4>
                    <table class="result-table">
                        <tr>
                            <td>Sem Mitigação:</td>
                            <td class="negative">- R$ 25.000,00</td>
                        </tr>
                        <tr>
                            <td>Com Estratégias Selecionadas:</td>
                            <td class="negative">- R$ 7.500,00</td>
                        </tr>
                        <tr>
                            <td>Redução do Impacto:</td>
                            <td class="positive">70%</td>
                        </tr>
                        <tr>
                            <td>Custo de Implementação:</td>
                            <td class="negative">R$ 2.300,00</td>
                        </tr>
                        <tr>
                            <td>Estratégias Mais Eficazes:</td>
                            <td>1. Capital de Giro<br>2. Antecipação de Recebíveis</td>
                        </tr>
                    </table>
                </div>
            `;
        }
        
        // Atualizar memória de cálculo
        function atualizarMemoriaCalculo() {
            const ano = document.getElementById('select-ano-memoria').value;
            
            // A lógica real de memória de cálculo será implementada posteriormente
            // Por enquanto, apenas um exemplo
            
            let memoria = `=== MEMÓRIA DE CÁLCULO - ANO ${ano} ===\n\n`;
            
            memoria += `=== PARÂMETROS BÁSICOS ===\n`;
            memoria += `Faturamento Mensal: R$ ${formatarNumero(extrairValorNumerico(document.getElementById('faturamento').value))}\n`;
            memoria += `Alíquota Efetiva: ${document.getElementById('aliquota').value}%\n`;
            memoria += `Prazo Médio de Recebimento: ${document.getElementById('pmr').value} dias\n`;
            memoria += `Prazo Médio de Pagamento: ${document.getElementById('pmp').value} dias\n`;
            memoria += `Prazo Médio de Estoque: ${document.getElementById('pme').value} dias\n`;
            memoria += `Ciclo Financeiro: ${document.getElementById('ciclo-financeiro').value} dias\n`;
            memoria += `Percentual de Vendas à Vista: ${document.getElementById('perc-vista').value}%\n`;
            memoria += `Percentual de Vendas a Prazo: ${document.getElementById('perc-prazo').value}%\n\n`;
            
            memoria += `=== CÁLCULO DO IMPACTO NO FLUXO DE CAIXA ===\n`;
            const faturamento = extrairValorNumerico(document.getElementById('faturamento').value);
            const aliquota = parseFloat(document.getElementById('aliquota').value) / 100;
            const valorImposto = faturamento * aliquota;
            
            memoria += `Valor do Imposto Mensal: R$ ${formatarNumero(faturamento)} × ${formatarNumero(aliquota * 100)}% = R$ ${formatarNumero(valorImposto)}\n`;
            
            // Obter percentual de implementação para o ano selecionado
            const percentualImplementacao = parseFloat(document.querySelector(`#tabela-fases input[data-ano="${ano}"]`).value) / 100;
            const impactoAno = valorImposto * percentualImplementacao;
            
            memoria += `Percentual de Implementação (${ano}): ${formatarNumero(percentualImplementacao * 100)}%\n`;
            memoria += `Impacto no Fluxo de Caixa: R$ ${formatarNumero(valorImposto)} × ${formatarNumero(percentualImplementacao * 100)}% = R$ ${formatarNumero(impactoAno)}\n\n`;
            
            memoria += `=== ANÁLISE DO CAPITAL DE GIRO ===\n`;
            const pmr = parseInt(document.getElementById('pmr').value);
            const impactoDias = pmr * (impactoAno / faturamento);
            
            memoria += `Impacto em Dias de Faturamento: ${formatarNumero(pmr)} × ${formatarNumero(impactoAno / faturamento * 100)}% = ${formatarNumero(impactoDias)} dias\n`;
            memoria += `Necessidade Adicional de Capital de Giro: R$ ${formatarNumero(impactoAno * 1.2)}\n\n`;
            
            memoria += `=== IMPACTO NA RENTABILIDADE ===\n`;
            const margem = parseFloat(document.getElementById('margem').value) / 100;
            const custoGiro = 0.021; // Taxa de capital de giro (2,1% a.m.)
            const custoAnual = impactoAno * custoGiro * 12;
            const impactoMargem = custoAnual / (faturamento * 12);
            
            memoria += `Margem Operacional Original: ${formatarNumero(margem * 100)}%\n`;
            memoria += `Custo Financeiro Mensal: R$ ${formatarNumero(impactoAno)} × ${formatarNumero(custoGiro * 100)}% = R$ ${formatarNumero(impactoAno * custoGiro)}\n`;
            memoria += `Custo Financeiro Anual: R$ ${formatarNumero(impactoAno * custoGiro)} × 12 = R$ ${formatarNumero(custoAnual)}\n`;
            memoria += `Impacto na Margem: R$ ${formatarNumero(custoAnual)} ÷ R$ ${formatarNumero(faturamento * 12)} = ${formatarNumero(impactoMargem * 100)}%\n`;
            memoria += `Margem Ajustada: ${formatarNumero(margem * 100)}% - ${formatarNumero(impactoMargem * 100)}% = ${formatarNumero((margem - impactoMargem) * 100)}%\n\n`;
            
            document.getElementById('memoria-calculo').textContent = memoria;
        }
        
        // Salvar configurações
        function salvarConfiguracoes() {
            try {
                // Coletar configurações
                const config = {
                    parametrosFinanceiros: {
                        taxaAntecipacao: parseFloat(document.getElementById('taxa-antecipacao').value) / 100,
                        taxaCapitalGiro: parseFloat(document.getElementById('taxa-capital-giro').value) / 100,
                        spreadBancario: parseFloat(document.getElementById('spread-bancario').value),
                        custoAdequacao: extrairValorNumerico(document.getElementById('custo-adequacao').value)
                    },
                    cronogramaImplementacao: {},
                    parametrosSetoriais: {}
                };
                
                // Coletar cronograma
                document.querySelectorAll('#tabela-fases input[data-ano]').forEach(input => {
                    const ano = input.getAttribute('data-ano');
                    config.cronogramaImplementacao[ano] = parseFloat(input.value) / 100;
                });
                
                // Coletar parâmetros setoriais
                const setores = ['comercio', 'industria', 'servicos', 'agronegocio', 'construcao', 'tecnologia', 'saude', 'educacao'];
                setores.forEach(setor => {
                    config.parametrosSetoriais[setor] = {
                        aliquota: parseFloat(document.querySelector(`input[data-setor="${setor}"][data-campo="aliquota"]`).value) / 100,
                        implementacao: parseFloat(document.querySelector(`input[data-setor="${setor}"][data-campo="implementacao"]`).value) / 100,
                        cronograma: document.querySelector(`select[data-setor="${setor}"][data-campo="cronograma"]`).value
                    };
                });
                
                // Salvar no localStorage
                localStorage.setItem('configSplitPayment', JSON.stringify(config));
                
                alert('Configurações salvas com sucesso!');
            } catch (error) {
                console.error('Erro ao salvar configurações:', error);
                alert('Erro ao salvar configurações: ' + error.message);
            }
        }
        
        // Carregar configurações
        function carregarConfiguracoes() {
            try {
                const configSalva = localStorage.getItem('configSplitPayment');
                if (configSalva) {
                    const config = JSON.parse(configSalva);
                    
                    // Carregar parâmetros financeiros
                    if (config.parametrosFinanceiros) {
                        document.getElementById('taxa-antecipacao').value = (config.parametrosFinanceiros.taxaAntecipacao * 100).toFixed(1);
                        document.getElementById('taxa-capital-giro').value = (config.parametrosFinanceiros.taxaCapitalGiro * 100).toFixed(1);
                        document.getElementById('spread-bancario').value = config.parametrosFinanceiros.spreadBancario.toFixed(1);
                        document.getElementById('custo-adequacao').value = 'R$ ' + formatarNumeroComSeparador(config.parametrosFinanceiros.custoAdequacao);
                    }
                    
                    // Carregar cronograma
                    if (config.cronogramaImplementacao) {
                        for (const [ano, percentual] of Object.entries(config.cronogramaImplementacao)) {
                            const input = document.querySelector(`#tabela-fases input[data-ano="${ano}"]`);
                            if (input) {
                                input.value = (percentual * 100).toFixed(0);
                            }
                        }
                    }
                    
                    // Carregar parâmetros setoriais
                    if (config.parametrosSetoriais) {
                        for (const [setor, params] of Object.entries(config.parametrosSetoriais)) {
                            const inputAliquota = document.querySelector(`input[data-setor="${setor}"][data-campo="aliquota"]`);
                            const inputImplementacao = document.querySelector(`input[data-setor="${setor}"][data-campo="implementacao"]`);
                            const selectCronograma = document.querySelector(`select[data-setor="${setor}"][data-campo="cronograma"]`);
                            
                            if (inputAliquota) inputAliquota.value = (params.aliquota * 100).toFixed(1);
                            if (inputImplementacao) inputImplementacao.value = (params.implementacao * 100).toFixed(0);
                            if (selectCronograma) selectCronograma.value = params.cronograma;
                        }
                    }
                    
                    alert('Configurações carregadas com sucesso!');
                } else {
                    alert('Não há configurações salvas.');
                }
            } catch (error) {
                console.error('Erro ao carregar configurações:', error);
                alert('Erro ao carregar configurações: ' + error.message);
            }
        }
        
        // Restaurar padrões
        function restaurarPadroes() {
            if (confirm('Deseja restaurar todas as configurações para os valores padrão? Esta ação não pode ser desfeita.')) {
                // Restaurar parâmetros financeiros
                document.getElementById('taxa-antecipacao').value = '1.8';
                document.getElementById('taxa-capital-giro').value = '2.1';
                document.getElementById('spread-bancario').value = '3.5';
                document.getElementById('custo-adequacao').value = 'R$ 0,00';
                
                // Restaurar cronograma
                document.querySelector('#tabela-fases input[data-ano="2026"]').value = '10';
                document.querySelector('#tabela-fases input[data-ano="2027"]').value = '25';
                document.querySelector('#tabela-fases input[data-ano="2028"]').value = '40';
                document.querySelector('#tabela-fases input[data-ano="2029"]').value = '60';
                document.querySelector('#tabela-fases input[data-ano="2030"]').value = '80';
                document.querySelector('#tabela-fases input[data-ano="2031"]').value = '90';
                document.querySelector('#tabela-fases input[data-ano="2032"]').value = '95';
                document.querySelector('#tabela-fases input[data-ano="2033"]').value = '100';
                
                // Restaurar parâmetros setoriais
                const setoresDefault = {
                    'comercio': {aliquota: '26.5', implementacao: '10', cronograma: 'padrao'},
                    'industria': {aliquota: '22.0', implementacao: '10', cronograma: 'padrao'},
                    'servicos': {aliquota: '26.5', implementacao: '10', cronograma: 'padrao'},
                    'agronegocio': {aliquota: '19.5', implementacao: '5', cronograma: 'padrao'},
                    'construcao': {aliquota: '24.0', implementacao: '10', cronograma: 'padrao'},
                    'tecnologia': {aliquota: '26.5', implementacao: '15', cronograma: 'padrao'},
                    'saude': {aliquota: '14.5', implementacao: '10', cronograma: 'padrao'},
                    'educacao': {aliquota: '12.5', implementacao: '10', cronograma: 'padrao'}
                };
                
                for (const [setor, valores] of Object.entries(setoresDefault)) {
                    document.querySelector(`input[data-setor="${setor}"][data-campo="aliquota"]`).value = valores.aliquota;
                    document.querySelector(`input[data-setor="${setor}"][data-campo="implementacao"]`).value = valores.implementacao;
                    document.querySelector(`select[data-setor="${setor}"][data-campo="cronograma"]`).value = valores.cronograma;
                }
                
                alert('Configurações restauradas para os valores padrão.');
            }
        }
        
        // Formatação de números
        function formatarNumero(valor) {
            return valor.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Formatação de números com separador de milhares
        function formatarNumeroComSeparador(valor) {
            return valor.toLocaleString('pt-BR', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        // Exportação para PDF
        function exportarParaPDF() {
            try {
                if (typeof window.jspdf === 'undefined') {
                    alert('Biblioteca jsPDF não carregada. Por favor, aguarde e tente novamente.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                
                // Criar documento PDF
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Adicionar título
                doc.setFontSize(18);
                doc.text('Relatório de Impacto do Split Payment', 15, 15);
                
                // Data do relatório
                doc.setFontSize(10);
                const dataHora = new Date().toLocaleString('pt-BR');
                doc.text(`Data do relatório: ${dataHora}`, 15, 25);
                
                // Empresa
                doc.setFontSize(14);
                doc.text('Dados da Empresa', 15, 35);
                
                doc.setFontSize(10);
                let y = 45;
                
                // Dados básicos
                const empresa = document.getElementById('empresa').value || 'Não informado';
                const setor = document.getElementById('setor').options[document.getElementById('setor').selectedIndex].text;
                const regime = document.getElementById('regime').options[document.getElementById('regime').selectedIndex].text;
                const faturamento = extrairValorNumerico(document.getElementById('faturamento').value);
                
                doc.text(`Empresa: ${empresa}`, 15, y); y += 7;
                doc.text(`Setor: ${setor}`, 15, y); y += 7;
                doc.text(`Regime Tributário: ${regime}`, 15, y); y += 7;
                doc.text(`Faturamento Mensal: R$ ${formatarNumero(faturamento)}`, 15, y); y += 15;
                
                // Parâmetros da simulação
                doc.setFontSize(14);
                doc.text('Parâmetros da Simulação', 15, y); y += 10;
                
                doc.setFontSize(10);
                const pmr = document.getElementById('pmr').value;
                const pmp = document.getElementById('pmp').value;
                const pme = document.getElementById('pme').value;
                const ciclo = document.getElementById('ciclo-financeiro').value;
                const aliquota = document.getElementById('aliquota').value;
                const tipoOperacao = document.getElementById('tipo-operacao').options[document.getElementById('tipo-operacao').selectedIndex].text;
                
                doc.text(`Prazo Médio de Recebimento: ${pmr} dias`, 15, y); y += 7;
                doc.text(`Prazo Médio de Pagamento: ${pmp} dias`, 15, y); y += 7;
                doc.text(`Prazo Médio de Estoque: ${pme} dias`, 15, y); y += 7;
                doc.text(`Ciclo Financeiro: ${ciclo} dias`, 15, y); y += 7;
                doc.text(`Alíquota Efetiva: ${aliquota}%`, 15, y); y += 7;
                doc.text(`Tipo de Operação: ${tipoOperacao}`, 15, y); y += 15;
                
                // Resultados da simulação
                doc.setFontSize(14);
                doc.text('Resultados da Simulação', 15, y); y += 10;
                
                doc.setFontSize(10);
                // Aqui serão adicionados os resultados reais da simulação
                // Por enquanto, usamos valores de exemplo
                const valorImposto = faturamento * (parseFloat(aliquota) / 100);
                const percentualImplementacao = 0.10; // 10% em 2026
                const impactoInicial = valorImposto * percentualImplementacao;
                
                doc.text(`Valor Mensal de Impostos: R$ ${formatarNumero(valorImposto)}`, 15, y); y += 7;
                doc.text(`Percentual de Implementação (2026): 10%`, 15, y); y += 7;
                doc.text(`Impacto Inicial no Fluxo de Caixa: R$ ${formatarNumero(impactoInicial)}`, 15, y); y += 7;
                doc.text(`Impacto Percentual: ${formatarNumero((impactoInicial / faturamento) * 100)}%`, 15, y); y += 7;
                doc.text(`Necessidade Adicional de Capital: R$ ${formatarNumero(impactoInicial * 1.2)}`, 15, y); y += 15;
                
                // Conclusão
                doc.setFontSize(14);
                doc.text('Conclusão e Recomendações', 15, y); y += 10;
                
                doc.setFontSize(10);
                const conclusao = `A implementação do Split Payment terá um impacto significativo no fluxo de caixa da empresa,
especialmente durante o período de transição. Recomenda-se a adoção de estratégias de mitigação para minimizar os efeitos negativos,
como ajustes de preços, renegociação de prazos com fornecedores e obtenção de linhas de capital de giro.`;
                
                const linhasConclusao = doc.splitTextToSize(conclusao, 180);
                doc.text(linhasConclusao, 15, y);
                y += linhasConclusao.length * 5 + 10;
                
                // Rodapé
                doc.setFontSize(8);
                doc.text('© 2025 Expertzy Inteligência Tributária', doc.internal.pageSize.getWidth() / 2, doc.internal.pageSize.getHeight() - 10, { align: 'center' });
                
                // Salvar o arquivo
                doc.save(`relatorio-split-payment-${new Date().toISOString().slice(0, 10)}.pdf`);
                
            } catch (error) {
                console.error('Erro ao exportar para PDF:', error);
                alert('Ocorreu um erro ao exportar para PDF: ' + error.message);
            }
        }
        
        // Exportação para Excel
        function exportarParaExcel() {
            try {
                if (typeof XLSX === 'undefined') {
                    alert('Biblioteca XLSX não carregada. Por favor, aguarde e tente novamente.');
                    return;
                }
                
                // Criar workbook
                const wb = XLSX.utils.book_new();
                
                // Aba de Parâmetros
                const parametros = [
                    ['Simulador de Impacto do Split Payment no Fluxo de Caixa'],
                    ['Data do relatório', new Date().toLocaleString('pt-BR')],
                    [],
                    ['Dados da Empresa'],
                    ['Empresa', document.getElementById('empresa').value || 'Não informado'],
                    ['Setor', document.getElementById('setor').options[document.getElementById('setor').selectedIndex].text],
                    ['Regime Tributário', document.getElementById('regime').options[document.getElementById('regime').selectedIndex].text],
                    ['Faturamento Mensal', `R$ ${formatarNumero(extrairValorNumerico(document.getElementById('faturamento').value))}`],
                    [],
                    ['Parâmetros do Ciclo Financeiro'],
                    ['Prazo Médio de Recebimento', `${document.getElementById('pmr').value} dias`],
                    ['Prazo Médio de Pagamento', `${document.getElementById('pmp').value} dias`],
                    ['Prazo Médio de Estoque', `${document.getElementById('pme').value} dias`],
                    ['Ciclo Financeiro', `${document.getElementById('ciclo-financeiro').value} dias`],
                    ['Percentual de Vendas à Vista', `${document.getElementById('perc-vista').value}%`],
                    ['Percentual de Vendas a Prazo', `${document.getElementById('perc-prazo').value}%`],
                    [],
                    ['Parâmetros Tributários'],
                    ['Alíquota Efetiva', `${document.getElementById('aliquota').value}%`],
                    ['Tipo de Operação', document.getElementById('tipo-operacao').options[document.getElementById('tipo-operacao').selectedIndex].text],
                    ['Compensação de Créditos', document.getElementById('compensacao').options[document.getElementById('compensacao').selectedIndex].text]
                ];
                
                const wsParametros = XLSX.utils.aoa_to_sheet(parametros);
                XLSX.utils.book_append_sheet(wb, wsParametros, 'Parâmetros');
                
                // Aba de Resultados
                const faturamento = extrairValorNumerico(document.getElementById('faturamento').value);
                const aliquota = parseFloat(document.getElementById('aliquota').value) / 100;
                const valorImposto = faturamento * aliquota;
                
                const anos = ['2026', '2027', '2028', '2029', '2030', '2031', '2032', '2033'];
                const resultadosHeader = ['Ano', 'Percentual de Implementação', 'Impacto no Fluxo (R$)', 'Impacto Percentual', 'Necessidade de Capital (R$)'];
                const resultadosData = [resultadosHeader];
                
                for (const ano of anos) {
                    const percentual = parseFloat(document.querySelector(`#tabela-fases input[data-ano="${ano}"]`).value) / 100;
                    const impacto = valorImposto * percentual;
                    const impactoPercentual = (impacto / faturamento) * 100;
                    const necessidadeCapital = impacto * 1.2;
                    
                    resultadosData.push([
                        ano,
                        `${(percentual * 100).toFixed(0)}%`,
                        impacto,
                        `${impactoPercentual.toFixed(2)}%`,
                        necessidadeCapital
                    ]);
                }
                
                const wsResultados = XLSX.utils.aoa_to_sheet(resultadosData);
                XLSX.utils.book_append_sheet(wb, wsResultados, 'Resultados');
                
                // Aba de Estratégias
                const estrategiasData = [
                    ['Estratégias de Mitigação'],
                    [],
                    ['Estratégia', 'Descrição', 'Impacto Estimado', 'Custo de Implementação']
                ];
                
                if (document.getElementById('ap-ativar').value === '1') {
                    estrategiasData.push([
                        'Ajuste de Preços',
                        `Aumento de ${document.getElementById('ap-percentual').value}% nos preços`,
                        'Médio',
                        'Baixo'
                    ]);
                }
                
                if (document.getElementById('rp-ativar').value === '1') {
                    estrategiasData.push([
                        'Renegociação de Prazos',
                        `Aumento de ${document.getElementById('rp-aumento-prazo').value} dias no prazo de pagamento`,
                        'Alto',
                        'Médio'
                    ]);
                }
                
                if (document.getElementById('ar-ativar').value === '1') {
                    estrategiasData.push([
                        'Antecipação de Recebíveis',
                        `Antecipação de ${document.getElementById('ar-percentual').value}% dos recebíveis`,
                        'Alto',
                        'Alto'
                    ]);
                }
                
                if (document.getElementById('cg-ativar').value === '1') {
                    estrategiasData.push([
                        'Capital de Giro',
                        `Captação de ${document.getElementById('cg-valor').value}% da necessidade adicional`,
                        'Alto',
                        'Médio'
                    ]);
                }
                
                if (document.getElementById('mp-ativar').value === '1') {
                    estrategiasData.push([
                        'Mix de Produtos',
                        `Ajuste de ${document.getElementById('mp-percentual').value}% no mix de produtos`,
                        'Médio',
                        'Baixo'
                    ]);
                }
                
                if (document.getElementById('mp-pag-ativar').value === '1') {
                    estrategiasData.push([
                        'Meios de Pagamento',
                        `Incentivo de ${document.getElementById('mp-pag-taxa-incentivo').value}% para pagamento à vista`,
                        'Médio',
                        'Médio'
                    ]);
                }
                
                const wsEstrategias = XLSX.utils.aoa_to_sheet(estrategiasData);
                XLSX.utils.book_append_sheet(wb, wsEstrategias, 'Estratégias');
                
                // Salvar o arquivo
                XLSX.writeFile(wb, `split-payment-${new Date().toISOString().slice(0, 10)}.xlsx`);
                
            } catch (error) {
                console.error('Erro ao exportar para Excel:', error);
                alert('Ocorreu um erro ao exportar para Excel: ' + error.message);
            }
        }
        
        // Exportação da memória de cálculo
        function exportarMemoriaCalculo() {
            try {
                const memoria = document.getElementById('memoria-calculo').textContent;
                
                if (!memoria || memoria.trim() === '') {
                    alert('Não há memória de cálculo para exportar. Realize uma simulação primeiro.');
                    return;
                }
                
                // Criar blob e link para download
                const blob = new Blob([memoria], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `memoria-calculo-split-payment-${new Date().toISOString().slice(0, 10)}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
            } catch (error) {
                console.error('Erro ao exportar memória de cálculo:', error);
                alert('Ocorreu um erro ao exportar a memória de cálculo: ' + error.message);
            }
        }
        
        // Exportação do relatório de estratégias
        function exportarRelatorioEstrategias() {
            try {
                if (typeof window.jspdf === 'undefined') {
                    alert('Biblioteca jsPDF não carregada. Por favor, aguarde e tente novamente.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                
                // Criar documento PDF
                const doc = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                // Adicionar título
                doc.setFontSize(18);
                doc.text('Relatório de Estratégias de Mitigação', 15, 15);
                
                // Data do relatório
                doc.setFontSize(10);
                const dataHora = new Date().toLocaleString('pt-BR');
                doc.text(`Data do relatório: ${dataHora}`, 15, 25);
                
                // Empresa
                doc.setFontSize(14);
                doc.text('Dados da Empresa', 15, 35);
                
                doc.setFontSize(10);
                let y = 45;
                
                // Dados básicos
                const empresa = document.getElementById('empresa').value || 'Não informado';
                const setor = document.getElementById('setor').options[document.getElementById('setor').selectedIndex].text;
                const regime = document.getElementById('regime').options[document.getElementById('regime').selectedIndex].text;
                
                doc.text(`Empresa: ${empresa}`, 15, y); y += 7;
                doc.text(`Setor: ${setor}`, 15, y); y += 7;
                doc.text(`Regime Tributário: ${regime}`, 15, y); y += 15;
                
                // Estratégias selecionadas
                doc.setFontSize(14);
                doc.text('Estratégias Selecionadas', 15, y); y += 10;
                
                doc.setFontSize(10);
                
                // Ajuste de Preços
                if (document.getElementById('ap-ativar').value === '1') {
                    doc.text('Ajuste de Preços:', 15, y); y += 7;
                    doc.text(`- Percentual de Aumento: ${document.getElementById('ap-percentual').value}%`, 20, y); y += 7;
                    doc.text(`- Elasticidade-Preço: ${document.getElementById('ap-elasticidade').value}`, 20, y); y += 7;
                    doc.text(`- Impacto nas Vendas: ${document.getElementById('ap-impacto-vendas').value}%`, 20, y); y += 7;
                    doc.text(`- Período de Ajuste: ${document.getElementById('ap-periodo').value} meses`, 20, y); y += 10;
                }
                
                // Renegociação de Prazos
                if (document.getElementById('rp-ativar').value === '1') {
                    doc.text('Renegociação de Prazos:', 15, y); y += 7;
                    doc.text(`- Aumento do Prazo: ${document.getElementById('rp-aumento-prazo').value} dias`, 20, y); y += 7;
                    doc.text(`- Percentual de Fornecedores: ${document.getElementById('rp-percentual').value}%`, 20, y); y += 7;
                    doc.text(`- Contrapartidas: ${document.getElementById('rp-contrapartidas').options[document.getElementById('rp-contrapartidas').selectedIndex].text}`, 20, y); y += 7;
                    doc.text(`- Custo da Contrapartida: ${document.getElementById('rp-custo').value}%`, 20, y); y += 10;
                }
                
                // Antecipação de Recebíveis
                if (document.getElementById('ar-ativar').value === '1') {
                    doc.text('Antecipação de Recebíveis:', 15, y); y += 7;
                    doc.text(`- Percentual de Antecipação: ${document.getElementById('ar-percentual').value}%`, 20, y); y += 7;
                    doc.text(`- Taxa de Desconto: ${document.getElementById('ar-taxa').value}% a.m.`, 20, y); y += 7;
                    doc.text(`- Prazo Médio Antecipado: ${document.getElementById('ar-prazo').value} dias`, 20, y); y += 10;
                }
                
                // Capital de Giro
                if (document.getElementById('cg-ativar').value === '1') {
                    doc.text('Capital de Giro:', 15, y); y += 7;
                    doc.text(`- Valor de Captação: ${document.getElementById('cg-valor').value}%`, 20, y); y += 7;
                    doc.text(`- Taxa de Juros: ${document.getElementById('cg-taxa').value}% a.m.`, 20, y); y += 7;
                    doc.text(`- Prazo de Pagamento: ${document.getElementById('cg-prazo').value} meses`, 20, y); y += 7;
                    doc.text(`- Carência: ${document.getElementById('cg-carencia').value} meses`, 20, y); y += 10;
                }
                
                // Mix de Produtos
                if (document.getElementById('mp-ativar').value === '1') {
                    doc.text('Mix de Produtos:', 15, y); y += 7;
                    doc.text(`- Percentual de Ajuste: ${document.getElementById('mp-percentual').value}%`, 20, y); y += 7;
                    doc.text(`- Foco do Ajuste: ${document.getElementById('mp-foco').options[document.getElementById('mp-foco').selectedIndex].text}`, 20, y); y += 7;
                    doc.text(`- Impacto na Receita: ${document.getElementById('mp-impacto-receita').value}%`, 20, y); y += 7;
                    doc.text(`- Impacto na Margem: ${document.getElementById('mp-impacto-margem').value} p.p.`, 20, y); y += 10;
                }
                
                // Meios de Pagamento
                if (document.getElementById('mp-pag-ativar').value === '1') {
                    doc.text('Meios de Pagamento:', 15, y); y += 7;
                    doc.text(`- Nova Distribuição: À Vista (${document.getElementById('mp-pag-vista-novo').value}%), 30 dias (${document.getElementById('mp-pag-30-novo').value}%),`, 20, y); y += 7;
                    doc.text(`  60 dias (${document.getElementById('mp-pag-60-novo').value}%), 90 dias (${document.getElementById('mp-pag-90-novo').value}%)`, 20, y); y += 7;
                    doc.text(`- Taxa de Incentivo: ${document.getElementById('mp-pag-taxa-incentivo').value}%`, 20, y); y += 10;
                }
                
                // Análise de eficácia
                doc.setFontSize(14);
                doc.text('Análise de Eficácia das Estratégias', 15, y); y += 10;
                
                doc.setFontSize(10);
                const analise = `Após a análise de todas as estratégias de mitigação selecionadas, 
estima-se uma redução de aproximadamente 70% no impacto do Split Payment no fluxo de caixa da empresa.
As estratégias mais eficazes foram a obtenção de capital de giro e a antecipação de recebíveis,
que juntas representam cerca de 60% da redução total do impacto.`;
                
                const linhasAnalise = doc.splitTextToSize(analise, 180);
                doc.text(linhasAnalise, 15, y);
                y += linhasAnalise.length * 5 + 10;
                
                // Recomendações
                doc.setFontSize(14);
                doc.text('Recomendações', 15, y); y += 10;
                
                doc.setFontSize(10);
                const recomendacoes = `Recomenda-se a implementação gradual das estratégias selecionadas,
começando por aquelas de menor custo e maior impacto, como a renegociação de prazos com fornecedores
e os ajustes no mix de produtos. Para estratégias de maior custo, como a antecipação de recebíveis
e a captação de capital de giro, é aconselhável realizar uma análise detalhada de custo-benefício
específica para cada operação.`;
                
                const linhasRecomendacoes = doc.splitTextToSize(recomendacoes, 180);
                doc.text(linhasRecomendacoes, 15, y);
                
                // Rodapé
                doc.setFontSize(8);
                doc.text('© 2025 Expertzy Inteligência Tributária', doc.internal.pageSize.getWidth() / 2, doc.internal.pageSize.getHeight() - 10, { align: 'center' });
                
                // Salvar o arquivo
                doc.save(`estrategias-split-payment-${new Date().toISOString().slice(0, 10)}.pdf`);
                
            } catch (error) {
                console.error('Erro ao exportar relatório de estratégias:', error);
                alert('Ocorreu um erro ao exportar o relatório de estratégias: ' + error.message);
            }
        }
        
        // Módulo SimuladorFluxoCaixa - Extensão para suporte a setores específicos
		if (typeof SimuladorFluxoCaixa === 'undefined') {
			// Se o objeto SimuladorFluxoCaixa ainda não existir, crie-o
			const SimuladorFluxoCaixa = {
				// Funções básicas de simulação
			};
			window.SimuladorFluxoCaixa = SimuladorFluxoCaixa;
		} 

		// Adicione os métodos relacionados a setores ao objeto SimuladorFluxoCaixa
		SimuladorFluxoCaixa.calcularImpactoSetorial = function(dados, ano) {
			// Obter o setor do formulário
			const codigoSetor = dados.setor;
			const setor = SetoresManager.setores[codigoSetor] || null;
			
			// Se não houver setor, usar cálculo padrão
			if (!setor) {
				return this.calcularImpactoCapitalGiro(dados, ano);
			}
			
			// Verificar se o setor tem cronograma próprio
			let percentualImplementacao = this.obterPercentualImplementacao(ano);
			
			if (setor.cronogramaProprio) {
				// Usar cronograma específico do setor, se disponível
				// Exemplo de lógica para cronograma específico (deve ser adaptada)
				switch (setor.nome) {
					case "Combustíveis e Energia":
						percentualImplementacao = percentualImplementacao * 0.8; // Implementação mais lenta
						break;
					case "Indústria de Petróleo":
						percentualImplementacao = percentualImplementacao * 0.7; // Implementação mais lenta
						break;
					case "Bens de Capital":
						if (ano < 2028) {
							percentualImplementacao = 0; // Suspensão até 2028
						} else {
							percentualImplementacao = percentualImplementacao * 0.5;
						}
						break;
					default:
						// Manter o percentual padrão
						break;
				}
			}
			
			// Ajustar alíquota com base nas reduções do setor
			const aliquotaAjustada = dados.aliquota;
			
			// Realizar cálculo de impacto considerando as características setoriais
			const resultadoAtual = this.calcularFluxoCaixaAtual(dados);
			const resultadoSplitPayment = this.calcularFluxoCaixaSplitPayment({
				...dados,
				aliquota: aliquotaAjustada,
				percentualImplementacao: percentualImplementacao
			}, ano);
			
			// Cálculos de impacto, similares ao método padrão
			const diferencaCapitalGiro = resultadoSplitPayment.capitalGiroDisponivel - resultadoAtual.capitalGiroDisponivel;
			const percentualImpacto = (diferencaCapitalGiro / resultadoAtual.capitalGiroDisponivel) * 100;
			const custoFinanceiro = Math.abs(diferencaCapitalGiro) * dados.taxaCapitalGiro;
			const impactoMargem = (custoFinanceiro / dados.faturamento) * 100;
			
			// Resultado específico do setor
			return {
				setor: setor.nome,
				aliquotaEfetiva: aliquotaAjustada,
				reducaoAplicada: setor.reducaoEspecial,
				percentualImplementacao: percentualImplementacao,
				resultadoAtual: resultadoAtual,
				resultadoSplitPayment: resultadoSplitPayment,
				diferencaCapitalGiro: diferencaCapitalGiro,
				percentualImpacto: percentualImpacto,
				custoFinanceiro: custoFinanceiro,
				impactoMargem: impactoMargem,
				ano: ano
			};
		};

		SimuladorFluxoCaixa.obterPercentualImplementacao = function(ano) {
			const cronograma = {
				2026: 0.10,
				2027: 0.25,
				2028: 0.40,
				2029: 0.55,
				2030: 0.70,
				2031: 0.85,
				2032: 0.95,
				2033: 1.00
			};
			
			return cronograma[ano] || 0;
		};
		
		/**
		 * Função para popular a lista suspensa de setores no formulário de simulação
		 */
		function popularDropdownSetores() {
			const selectSetores = document.getElementById('setor');
			if (!selectSetores) return;
			
			// Limpar opções existentes (exceto a primeira "Selecione...")
			while (selectSetores.options.length > 1) {
				selectSetores.remove(1);
			}
			
			// Obter setores ordenados por nome
			const setoresOrdenados = Object.entries(SetoresManager.setores)
				.sort((a, b) => a[1].nome.localeCompare(b[1].nome));
			
			// Adicionar cada setor ao dropdown
			for (const [codigo, setor] of setoresOrdenados) {
				const option = document.createElement('option');
				option.value = codigo;
				option.textContent = setor.nome;
				selectSetores.appendChild(option);
			}
			
			console.log(`Dropdown de setores populado com ${setoresOrdenados.length} opções`);
		}

		/**
		 * Função para exibir resultados com informações setoriais
		 */
		function exibirResultadosSetoriais(resultados) {
			const containerResultados = document.getElementById('resultados');
			if (!containerResultados) return;
			
			// Extrair resultados setoriais
			const impacto = resultados.impactoSetorial || resultados.impactoBase;
			const setor = impacto.setor || "Não especificado";
			const reducaoAplicada = impacto.reducaoAplicada || 0;
			
			// Construir HTML com informações setoriais
			let htmlSetorial = `
				<div class="result-section">
					<h4>Informações Setoriais</h4>
					<table class="result-table">
						<tr>
							<td>Setor:</td>
							<td>${setor}</td>
						</tr>
						<tr>
							<td>Alíquota Efetiva:</td>
							<td>${(impacto.aliquotaEfetiva * 100).toFixed(1)}%</td>
						</tr>
						<tr>
							<td>Redução Setorial Aplicada:</td>
							<td>${reducaoAplicada.toFixed(1)}%</td>
						</tr>
						<tr>
							<td>Percentual de Implementação (${impacto.ano}):</td>
							<td>${(impacto.percentualImplementacao * 100).toFixed(0)}%</td>
						</tr>
					</table>
				</div>
			`;
			
			// Inserir informações setoriais após o cabeçalho dos resultados
			const resultCard = containerResultados.querySelector('.result-card');
			if (resultCard) {
				const primeiraSecao = resultCard.querySelector('.result-section');
				if (primeiraSecao) {
					primeiraSecao.insertAdjacentHTML('afterend', htmlSetorial);
				}
			}
		}

		/**
		 * Função para atualizar memória de cálculo com informações setoriais
		 */
		function atualizarMemoriaCalculoSetorial(ano) {
			const memoriaElement = document.getElementById('memoria-calculo');
			if (!memoriaElement) return;
			
			// Obter setor
			const codigoSetor = document.getElementById('setor').value;
			const setor = SetoresManager.setores[codigoSetor] || null;
			
			if (setor) {
				let memoria = memoriaElement.textContent;
				
				// Adicionar seção sobre informações setoriais
				const secaoSetorial = `
		=== INFORMAÇÕES SETORIAIS ===
		Setor: ${setor.nome}
		Alíquota Base: ${setor.aliquotaEfetiva.toFixed(1)}%
		Redução Setorial: ${setor.reducaoEspecial.toFixed(1)}%
		Alíquota Efetiva: ${(setor.aliquotaEfetiva - setor.reducaoEspecial).toFixed(1)}%
		Implementação Inicial: ${setor.implementacaoInicial}%
		Cronograma Próprio: ${setor.cronogramaProprio ? 'Sim' : 'Não'}
		`;
				
				// Inserir no início da memória de cálculo
				memoria = memoria.replace('=== PARÂMETROS BÁSICOS ===', secaoSetorial + '\n=== PARÂMETROS BÁSICOS ===');
				
				memoriaElement.textContent = memoria;
			}
		}
		
		// Adicionar event listener para atualizar alíquota ao selecionar setor
		document.addEventListener('DOMContentLoaded', function() {
			// Verificar se o elemento existe antes de adicionar o event listener
			const selectSetor = document.getElementById('setor');
			if (selectSetor) {
				selectSetor.addEventListener('change', function() {
					const setorSelecionado = this.value;
					
					if (setorSelecionado && SetoresManager.setores[setorSelecionado]) {
						// Preencher alíquota com base no setor selecionado
						const setor = SetoresManager.setores[setorSelecionado];
						const aliquotaEfetiva = setor.aliquotaEfetiva - setor.reducaoEspecial;
						
						// Atualizar campo de alíquota
						const campoAliquota = document.getElementById('aliquota');
						if (campoAliquota) {
							campoAliquota.value = aliquotaEfetiva.toFixed(1);
							console.log(`Alíquota atualizada para ${aliquotaEfetiva.toFixed(1)}% com base no setor "${setor.nome}"`);
						}
					}
				});
			}
			
			// Carregar setores e popular dropdown na inicialização
			try {
				if (typeof SetoresManager !== 'undefined') {
					// Inicializar o gerenciador de setores se não foi inicializado
					if (!SetoresManager.initialized) {
						SetoresManager.inicializar();
						SetoresManager.initialized = true;
					}
					
					// Popular dropdown de setores
					popularDropdownSetores();
				}
			} catch (error) {
				console.error('Erro ao integrar gerenciador de setores:', error);
			}
			
			// Atualizar dropdown de setores quando trocar para a aba de simulação
			document.querySelectorAll('.tab-button').forEach(button => {
				button.addEventListener('click', function() {
					const tabId = this.getAttribute('data-tab');
					if (tabId === 'simulacao') {
						popularDropdownSetores();
					}
				});
			});
		});
    </script>
</body>
</html>
