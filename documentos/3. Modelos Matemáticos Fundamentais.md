# 3. Modelos Matemáticos Fundamentais

## 3.1 Fundamentos Conceituais do Modelo

O simulador de Split Payment baseia-se em modelos matemáticos precisos que quantificam o impacto desta mudança estrutural no sistema tributário sobre o fluxo de caixa e o capital de giro das empresas. A fundamentação matemática aqui apresentada constitui a espinha dorsal do simulador, permitindo estimativas precisas dos efeitos financeiros ao longo do período de implementação.

### 3.1.1 Modelo de Impacto sobre o Capital de Giro

O primeiro e mais fundamental modelo implementado no simulador é a equação que quantifica o impacto direto do Split Payment sobre o capital de giro disponível. Este modelo captura a essência da mudança: a eliminação do intervalo temporal entre o recebimento pela venda e o pagamento do imposto correspondente.

A equação fundamental implementada é:

$$\Delta CG = VT \times (PMR + PR - PMR')$$

Onde:

- $\Delta CG$ = Variação no capital de giro disponível (em R$)
- $VT$ = Valor tributário sujeito ao split payment (em R$)
- $PMR$ = Prazo médio de recebimento no regime atual (em dias)
- $PR$ = Prazo de recolhimento do tributo no regime atual (em dias)
- $PMR'$ = Prazo médio de recebimento ajustado no novo regime (em dias)

**Interpretação das Variáveis:**

- $VT$ representa o montante total de impostos (IBS + CBS) que está sujeito ao mecanismo de Split Payment. No código do simulador, esta variável é calculada como o produto do faturamento bruto pela alíquota efetiva: `VT = faturamentoBruto * aliquotaEfetiva`.

- $PMR$ reflete o tempo médio que a empresa leva para receber o pagamento de seus clientes no regime atual. Esta variável é inserida diretamente pelo usuário no formulário de parametrização.

- $PR$ corresponde ao tempo entre o fato gerador do tributo e a data efetiva de seu recolhimento no regime atual. No sistema tributário brasileiro, este prazo é tipicamente de 25 dias após o encerramento do mês (valor padrão = 55 dias).

- $PMR'$ é o prazo médio de recebimento ajustado no novo regime de Split Payment. Na implementação completa do Split Payment, este valor tende a ser igual ao $PMR$ para a parcela não tributária e zero para a parcela tributária, já que esta última é recolhida imediatamente.

### 3.1.2 Modelo da Necessidade de Capital de Giro (NCG)

O segundo modelo fundamental implementado relaciona-se à Necessidade de Capital de Giro, que reflete o montante de recursos necessários para manter as operações da empresa:

$$NCG = AC_{op} - PC_{op}$$

Onde:

- $NCG$ = Necessidade de Capital de Giro (em R$)
- $AC_{op}$ = Ativos Circulantes Operacionais (em R$)
- $PC_{op}$ = Passivos Circulantes Operacionais (em R$)

**Desdobramento das Variáveis:**

- $AC_{op}$ = Estoques + Clientes (Contas a Receber) + Outros Créditos Operacionais
- $PC_{op}$ = Fornecedores (Contas a Pagar) + Obrigações Fiscais + Outros Débitos Operacionais

O Split Payment afeta diretamente este cálculo ao alterar a dinâmica das obrigações fiscais, criando uma nova configuração para a NCG:

$$NCG_{split} = AC_{op} - (PC_{op} - OF_{atual} + OF_{split})$$

Onde:

- $OF_{atual}$ = Obrigações fiscais no regime atual (em R$)
- $OF_{split}$ = Obrigações fiscais no regime de Split Payment (em R$)

No simulador, estas variáveis são calculadas considerando o cronograma de implementação progressiva, permitindo uma estimativa precisa da evolução da NCG durante o período de transição.

### 3.1.3 Modelo de Fluxo de Caixa Descontado Ajustado

Para capturar a dinâmica temporal e a sensibilidade das variáveis, o simulador implementa um modelo de fluxo de caixa descontado ajustado:

$$FCDaj = \sum_{t=1}^{n} \frac{FCO_t - VTR_t \times (1 - \frac{CT_t}{VTR_t})}{(1 + TMA)^t}$$

Onde:

- $FCDaj$ = Fluxo de caixa descontado ajustado (em R$)
- $FCO_t$ = Fluxo de caixa operacional no período t (em R$)
- $VTR_t$ = Valor tributário retido no período t (em R$)
- $CT_t$ = Créditos tributários no período t (em R$)
- $TMA$ = Taxa mínima de atratividade (custo de capital) (em % a.a.)
- $t$ = Período de tempo (em anos)
- $n$ = Horizonte total de projeção (em anos)

**Detalhamento das Variáveis:**

- $FCO_t$ representa o fluxo de caixa operacional projetado para cada período antes do efeito do Split Payment. É calculado seguindo a abordagem tradicional: `EBITDA - ∆NCG - Impostos sobre o Resultado`.

- $VTR_t$ é o valor tributário efetivamente retido em cada período, considerando o cronograma de implementação progressiva. É calculado como: `VTR_t = VT * FPI_t`, onde `FPI_t` é o Fator de Progressão da Implementação no período t.

- $CT_t$ são os créditos tributários disponíveis para compensação no período t. Estes valores são inseridos pelo usuário ou estimados com base em parâmetros do negócio.

- $TMA$ é a taxa de desconto aplicada para trazer os fluxos futuros a valor presente, representando o custo de oportunidade do capital. No simulador, esta taxa é parametrizável, com um valor padrão de 12% a.a.

### 3.1.4 Modelo do Ciclo Financeiro

O simulador também incorpora o cálculo do ciclo financeiro completo da empresa, fundamental para a análise do impacto do Split Payment:

$$CF = PME + PMR - PMP$$

Onde:

- $CF$ = Ciclo Financeiro (em dias)
- $PME$ = Prazo Médio de Estoque (em dias)
- $PMR$ = Prazo Médio de Recebimento (em dias)
- $PMP$ = Prazo Médio de Pagamento (em dias)

O impacto do Split Payment no ciclo financeiro é então calculado como:

$$CF_{split} = PME + PMR - PMP - (PMR \times \frac{VTR}{VT})$$

Onde $\frac{VTR}{VT}$ representa a proporção do valor tributário que é retida imediatamente através do Split Payment, considerando o cronograma de implementação progressiva.

## 3.2 Algoritmos de Simulação do Impacto no Fluxo de Caixa

### 3.2.1 Algoritmo Fundamental

O algoritmo central implementado no simulador para calcular o impacto do Split Payment segue esta estrutura lógica:

```
Procedimento CalcularImpactoSplitPayment():
    Para cada período t no horizonte de planejamento:
        Para cada setor s na economia:
            AE_s = CalcularAliquotaEfetiva(s, t)
            FTB_s_t = ObterfaturamentoTributável(s, t)
            CT_s_t = ObterCréditosTributários(s, t)
            VTR_s_t = FTB_s_t * AE_s - CT_s_t

            // Cálculo do fluxo no regime atual
            FC_Atual_s_t = FTB_s_t - AjustarTemporalmentePagamento(VTR_s_t, t+1)

            // Cálculo do fluxo no regime split payment
            FC_Split_s_t = FTB_s_t - VTR_s_t

            // Impacto no período
            Impacto_s_t = FC_Atual_s_t - FC_Split_s_t

            // Acumular resultados
            AcumularResultados(s, t, Impacto_s_t)
        Fim Para
    Fim Para

    // Gerar visualizações e relatórios
    GerarVisualizações()
    GerarRelatórioConsolidado()
Fim Procedimento
```

Este algoritmo é implementado no arquivo `simulator.js` do projeto, especificamente na função `simular()`.

### 3.2.2 Cálculo da Implementação Progressiva

O simulador considera o cronograma de implementação progressiva do Split Payment, conforme estabelecido pela legislação. O impacto progressivo é calculado através da função:

$$Impacto_{Progressivo} = VT \times FPI_t$$

Onde $FPI_t$ é o Fator de Progressão da Implementação no período t, seguindo o cronograma:

| Ano  | Percentual de Implementação (FPI) |
| ---- | --------------------------------- |
| 2026 | 10%                               |
| 2027 | 25%                               |
| 2028 | 40%                               |
| 2029 | 55%                               |
| 2030 | 70%                               |
| 2031 | 85%                               |
| 2032 | 95%                               |
| 2033 | 100%                              |

Este cronograma é parametrizado no simulador e pode ser ajustado conforme eventuais alterações na legislação.

### 3.2.3 Modelo de Compensação de Créditos Tributários

O simulador implementa um modelo de compensação de créditos tributários que considera o mecanismo de "Split Payment Inteligente" previsto no artigo 50 da LC 214/2025:

$$Retenção_{Efetiva} = max(0, VTR - CT)$$

Onde:

- $Retenção_{Efetiva}$ = Valor efetivamente retido via Split Payment após compensação de créditos (em R$)
- $VTR$ = Valor tributário bruto a ser retido (em R$)
- $CT$ = Créditos tributários disponíveis para compensação (em R$)

Na implementação em código, esta lógica é expressa como:

```javascript
function calcularRetencaoEfetiva(debitoTributario, creditosDisponiveis) {
    if (creditosDisponiveis >= debitoTributario) {
        return 0; // Compensação total
    } else {
        return debitoTributario - creditosDisponiveis; // Compensação parcial
    }
}
```

### 3.2.4 Distribuição de Recebimentos por Modalidade

O simulador também considera o impacto diferenciado conforme a modalidade de recebimento (à vista ou a prazo):

$$Impacto_{Distribuído} = (Valor_{Vista} \times AE - CT_{Vista}) + \sum_{p \in Prazos} (Valor_{Prazo,p} \times AE \times PercPrazo_p)$$

Onde:

- $Valor_{Vista}$ = Faturamento recebido à vista (em R$)
- $Valor_{Prazo,p}$ = Faturamento recebido no prazo p (em R$)
- $AE$ = Alíquota efetiva
- $CT_{Vista}$ = Créditos tributários alocados para vendas à vista (em R$)
- $PercPrazo_p$ = Percentual do faturamento a prazo recebido no prazo p (em %)

## 3.3 Equações para Cálculos de Impacto Setorial

### 3.3.1 Varejo de Alta Rotatividade

Para o setor varejista, caracterizado por alto giro e margens reduzidas, o simulador implementa o cálculo específico:

$$Impacto_{Diário-Varejo} = FD \times AE_v \times (1 - \frac{CI}{FD \times AE_v})$$

Onde:

- $FD$ = Faturamento diário (em R$)
- $AE_v$ = Alíquota efetiva para o varejo (em %)
- $CI$ = Créditos de insumos diários (em R$)

### 3.3.2 Indústria de Transformação

Para o setor industrial, com ciclos produtivos mais longos:

$$Impacto_{Anual-Indústria} = FA \times AE_i \times \frac{CP}{365} \times (1 - TC)$$

Onde:

- $FA$ = Faturamento anual (em R$)
- $AE_i$ = Alíquota efetiva para a indústria (em %)
- $CP$ = Ciclo produtivo em dias
- $TC$ = Taxa de compensação de créditos (0-1)

### 3.3.3 Serviços Contínuos

Para empresas de serviços contínuos, o modelo implementado é:

$$Impacto_{Mensal-Servicos} = RM \times AE_s \times (1 - \frac{CT_m}{RM \times AE_s})$$

Onde:

- $RM$ = Receita mensal recorrente (em R$)
- $AE_s$ = Alíquota efetiva para serviços (em %)
- $CT_m$ = Créditos tributários médios mensais (em R$)

### 3.3.4 Construção Civil

Para o setor de construção, com ciclos longos e recebimentos intermitentes:

$$Impacto_{Construcao} = VM \times AE_c \times \frac{PMR}{30} \times (1 - \frac{CT_c}{VM \times AE_c})$$

Onde:

- $VM$ = Valor médio mensal de medições (em R$)
- $AE_c$ = Alíquota efetiva para construção (em %)
- $PMR$ = Prazo médio de recebimento (em dias)
- $CT_c$ = Créditos tributários aplicáveis à construção (em R$)

## 3.4 Índice de Sensibilidade Setorial (IS)

O simulador implementa o cálculo do Índice de Sensibilidade (IS) que determina o grau de vulnerabilidade de cada setor ao Split Payment:

$$IS = \frac{AE_s \times PMR}{CO \times ML \times 100}$$

Onde:

- $AE_s$ = Alíquota efetiva do setor (em %)
- $PMR$ = Prazo médio de recebimento (em dias)
- $CO$ = Ciclo operacional (em dias)
- $ML$ = Margem líquida (em %)

Este índice é utilizado para classificar o impacto setorial em níveis:

- IS < 0.1: Baixo
- 0.1 ≤ IS < 0.2: Médio-Baixo
- 0.2 ≤ IS < 0.3: Médio
- 0.3 ≤ IS < 0.4: Médio-Alto
- IS ≥ 0.4: Alto

## 3.5 Modelos das Estratégias de Mitigação

### 3.5.1 Modelo de Ajuste de Preços

O modelo de ajuste de preços visa compensar a perda de fluxo de caixa transferindo parte do custo ao consumidor:

$$Compensacao_{AP} = F \times AP \times (1 + \frac{EP \times AP}{100})$$

Onde:

- $F$ = Faturamento mensal (em R$)
- $AP$ = Percentual de aumento de preços (em %)
- $EP$ = Elasticidade-preço da demanda

### 3.5.2 Modelo de Renegociação de Prazos com Fornecedores

Esta estratégia busca estender os prazos de pagamento, melhorando o ciclo financeiro:

$$Impacto_{RP} = PF \times \frac{AP}{30} \times PP \times (1 - \frac{CP}{100})$$

Onde:

- $PF$ = Pagamentos a fornecedores mensais (em R$)
- $AP$ = Aumento do prazo (em dias)
- $PP$ = Percentual de fornecedores participantes (em %)
- $CP$ = Custo das contrapartidas (em %)

### 3.5.3 Modelo de Antecipação de Recebíveis

A antecipação de recebíveis permite converter vendas a prazo em recursos imediatos:

$$Impacto_{AR} = F \times \frac{PP}{100} \times PA \times PMA \times (1 - \frac{TA \times PMA}{30 \times 100})$$

Onde:

- $F$ = Faturamento mensal (em R$)
- $PP$ = Percentual de vendas a prazo (em %)
- $PA$ = Percentual de antecipação (em %)
- $PMA$ = Prazo médio antecipado (em dias)
- $TA$ = Taxa de desconto (% a.m.)

### 3.5.4 Modelo de Captação de Capital de Giro

Para suprir a necessidade adicional de capital, o simulador modela a captação de financiamentos específicos:

$$Custo_{CG} = NCG \times VC \times \frac{TJ}{100} \times (1 + \frac{PP}{12})$$

Onde:

- $NCG$ = Necessidade adicional de capital de giro (em R$)
- $VC$ = Percentual do valor captado (em %)
- $TJ$ = Taxa de juros (% a.m.)
- $PP$ = Prazo de pagamento (meses)

### 3.5.5 Modelo de Ajuste no Mix de Produtos e Serviços

Alterações no mix de produtos podem priorizar itens com ciclo financeiro mais favorável:

$$Impacto_{MIX} = F \times PA \times (\frac{IR}{100} + \frac{IM}{100})$$

Onde:

- $F$ = Faturamento mensal (em R$)
- $PA$ = Percentual de ajuste (em %)
- $IR$ = Impacto na receita (em %)
- $IM$ = Impacto na margem (em p.p.)

### 3.5.6 Modelo de Incentivo a Meios de Pagamento Favoráveis

Este modelo estimula modalidades de pagamento que reduzam o prazo médio de recebimento:

$$Impacto_{MP} = F \times (1 - \frac{TI}{100}) \times (PVN - PVA)$$

Onde:

- $F$ = Faturamento mensal (em R$)
- $TI$ = Taxa de incentivo (em %)
- $PVN$ = Percentual de vendas à vista (novo) (em %)
- $PVA$ = Percentual de vendas à vista (atual) (em %)

### 3.5.7 Índice de Eficácia de Mitigação (IEM)

Para cada estratégia, o simulador calcula o Índice de Eficácia de Mitigação (IEM):

$$IEM = \frac{\Delta CG_{Com-Estrategia} - \Delta CG_{Sem-Estrategia}}{\Delta CG_{Sem-Estrategia}} \times 100$$

Valores positivos indicam melhoria do fluxo de caixa e valores negativos indicam deterioração. Este índice permite comparar diretamente a eficácia de diferentes abordagens e otimizar a combinação de estratégias.

## 3.6 Modelo de Impacto Combinado das Estratégias

O simulador implementa um cálculo do impacto combinado de múltiplas estratégias de mitigação, ajustando para evitar dupla contagem:

$$Impacto_{Combinado} = \sum_{i=1}^{n} (Impacto_{Estrategia_i} \times FI_i)$$

Onde:

- $Impacto_{Estrategia_i}$ = Impacto individual da estratégia i (em R$)
- $FI_i$ = Fator de interação da estratégia i (≤ 1)
- $n$ = Número total de estratégias implementadas

O fator de interação ($FI_i$) ajusta o impacto para evitar dupla contagem quando estratégias afetam os mesmos componentes do fluxo de caixa.

## 3.7 Modelo de Análise de Sensibilidade

Para avaliar a robustez das estimativas e a sensibilidade aos parâmetros de entrada, o simulador implementa análises de sensibilidade parametrizadas:

$$Sensibilidade_{Paramétrica} = \frac{% Variação_{Resultado}}{% Variação_{Parâmetro}}$$

Uma análise de sensibilidade é implementada para os principais parâmetros:

- Alíquota efetiva
- Prazo médio de recebimento
- Prazo médio de pagamento
- Taxa de crescimento
- Margem operacional

Esta abordagem permite identificar os parâmetros com maior impacto nos resultados e priorizar ações estratégicas.

Todos estes modelos matemáticos fundamentais estão implementados no código-fonte do simulador, principalmente nos arquivos `calculation.js` e `simulator.js`, garantindo uma análise precisa e abrangente do impacto do Split Payment no fluxo de caixa empresarial.
